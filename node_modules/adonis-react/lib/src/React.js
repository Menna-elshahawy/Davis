"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.prepareReact = void 0;
const react_1 = __importDefault(require("react"));
const server_1 = require("react-dom/server");
const adonisContext_1 = require("./adonisContext");
function prepareReact(ctx, app, Route) {
    const instance = new ReactInstance();
    instance.share({
        app,
        ctx,
        request: ctx.request,
        params: ctx.params,
        route: ctx.route,
        makeUrl(...args) {
            return Route.makeUrl(...args);
        },
        makeSignedUrl: (...args) => {
            return Route.makeSignedUrl(...args);
        },
    });
    return instance;
}
exports.prepareReact = prepareReact;
class ReactInstance {
    constructor() {
        this.context = {};
    }
    share(obj) {
        Object.assign(this.context, obj);
    }
    render(Component, props) {
        const html = server_1.renderToStaticMarkup(
        // @ts-expect-error Context is filled outside of this class
        react_1.default.createElement(adonisContext_1.AdonisContextProvider, { value: this.context },
            react_1.default.createElement(Component, Object.assign({}, props))));
        return `<!DOCTYPE html>\n${html}`;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVhY3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvUmVhY3QudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLGtEQUF1RTtBQUN2RSw2Q0FBd0Q7QUFNeEQsbURBQXdEO0FBRXhELFNBQWdCLFlBQVksQ0FDMUIsR0FBd0IsRUFDeEIsR0FBd0IsRUFDeEIsS0FBcUI7SUFFckIsTUFBTSxRQUFRLEdBQUcsSUFBSSxhQUFhLEVBQUUsQ0FBQztJQUNyQyxRQUFRLENBQUMsS0FBSyxDQUFDO1FBQ2IsR0FBRztRQUNILEdBQUc7UUFDSCxPQUFPLEVBQUUsR0FBRyxDQUFDLE9BQU87UUFDcEIsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNO1FBQ2xCLEtBQUssRUFBRSxHQUFHLENBQUMsS0FBSztRQUNoQixPQUFPLENBQUMsR0FBRyxJQUFzQztZQUMvQyxPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztRQUNoQyxDQUFDO1FBQ0QsYUFBYSxFQUFFLENBQUMsR0FBRyxJQUE0QyxFQUFFLEVBQUU7WUFDakUsT0FBTyxLQUFLLENBQUMsYUFBYSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFDdEMsQ0FBQztLQUNGLENBQUMsQ0FBQztJQUNILE9BQU8sUUFBUSxDQUFDO0FBQ2xCLENBQUM7QUFwQkQsb0NBb0JDO0FBRUQsTUFBTSxhQUFhO0lBQW5CO1FBQ1UsWUFBTyxHQUE0QixFQUFFLENBQUM7SUFtQmhELENBQUM7SUFqQlEsS0FBSyxDQUFDLEdBQTRCO1FBQ3ZDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRU0sTUFBTSxDQUNYLFNBQTJCLEVBQzNCLEtBQWtEO1FBRWxELE1BQU0sSUFBSSxHQUFHLDZCQUFvQjtRQUMvQiwyREFBMkQ7UUFDM0QsOEJBQUMscUNBQXFCLElBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxPQUFPO1lBRXhDLDhCQUFDLFNBQVMsb0JBQUssS0FBSyxFQUFJLENBQ0YsQ0FDekIsQ0FBQztRQUNGLE9BQU8sb0JBQW9CLElBQUksRUFBRSxDQUFDO0lBQ3BDLENBQUM7Q0FDRiJ9